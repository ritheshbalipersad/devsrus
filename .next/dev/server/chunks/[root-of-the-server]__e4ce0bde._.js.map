{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Source/Repos/devsrus/src/app/api/admin/upload/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { writeFile, mkdir } from \"fs/promises\";\nimport path from \"path\";\nimport { randomUUID } from \"crypto\";\n\nconst ALLOWED_TYPES = [\"image/jpeg\", \"image/png\", \"image/gif\", \"image/webp\"];\nconst MAX_SIZE = 5 * 1024 * 1024; // 5MB\n\nconst EXT_BY_TYPE: Record<string, string> = {\n  \"image/jpeg\": \"jpg\",\n  \"image/png\": \"png\",\n  \"image/gif\": \"gif\",\n  \"image/webp\": \"webp\",\n};\n\nexport async function POST(req: NextRequest) {\n  try {\n    const formData = await req.formData();\n    const file = formData.get(\"file\");\n\n    if (!file || !(file instanceof File)) {\n      return NextResponse.json(\n        { error: \"No file provided or invalid file\" },\n        { status: 400 }\n      );\n    }\n\n    if (!ALLOWED_TYPES.includes(file.type)) {\n      return NextResponse.json(\n        { error: \"Invalid file type. Use JPEG, PNG, GIF, or WebP.\" },\n        { status: 400 }\n      );\n    }\n\n    if (file.size > MAX_SIZE) {\n      return NextResponse.json(\n        { error: \"File too large. Maximum size is 5MB.\" },\n        { status: 400 }\n      );\n    }\n\n    const ext = EXT_BY_TYPE[file.type] ?? \"jpg\";\n    const name = `${randomUUID()}.${ext}`;\n    const uploadDir = path.join(process.cwd(), \"public\", \"uploads\", \"products\");\n    await mkdir(uploadDir, { recursive: true });\n    const filePath = path.join(uploadDir, name);\n\n    const bytes = await file.arrayBuffer();\n    const buffer = Buffer.from(bytes);\n    await writeFile(filePath, buffer);\n\n    const url = `/uploads/products/${name}`;\n    return NextResponse.json({ url });\n  } catch (err) {\n    console.error(\"Upload error:\", err);\n    return NextResponse.json(\n      { error: \"Failed to upload image\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,gBAAgB;IAAC;IAAc;IAAa;IAAa;CAAa;AAC5E,MAAM,WAAW,IAAI,OAAO,MAAM,MAAM;AAExC,MAAM,cAAsC;IAC1C,cAAc;IACd,aAAa;IACb,aAAa;IACb,cAAc;AAChB;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,WAAW,MAAM,IAAI,QAAQ;QACnC,MAAM,OAAO,SAAS,GAAG,CAAC;QAE1B,IAAI,CAAC,QAAQ,CAAC,CAAC,gBAAgB,IAAI,GAAG;YACpC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAmC,GAC5C;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,cAAc,QAAQ,CAAC,KAAK,IAAI,GAAG;YACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAkD,GAC3D;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,KAAK,IAAI,GAAG,UAAU;YACxB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,MAAM,WAAW,CAAC,KAAK,IAAI,CAAC,IAAI;QACtC,MAAM,OAAO,GAAG,IAAA,mHAAU,IAAG,CAAC,EAAE,KAAK;QACrC,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU,WAAW;QAChE,MAAM,IAAA,8HAAK,EAAC,WAAW;YAAE,WAAW;QAAK;QACzC,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,WAAW;QAEtC,MAAM,QAAQ,MAAM,KAAK,WAAW;QACpC,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,IAAA,kIAAS,EAAC,UAAU;QAE1B,MAAM,MAAM,CAAC,kBAAkB,EAAE,MAAM;QACvC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAI;IACjC,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}