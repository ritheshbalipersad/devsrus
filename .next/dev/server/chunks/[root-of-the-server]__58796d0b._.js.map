{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Source/Repos/devsrus/src/lib/inquiries.ts"],"sourcesContent":["import { promises as fs } from \"fs\";\nimport path from \"path\";\n\nexport type InquiryReply = {\n  message: string;\n  sentAt: string;\n};\n\nexport type Inquiry = {\n  id: string;\n  name: string;\n  email: string;\n  subject: string;\n  message: string;\n  status: \"new\" | \"replied\";\n  createdAt: string;\n  repliedAt?: string;\n  replies?: InquiryReply[];\n};\n\nconst DATA_DIR = path.join(process.cwd(), \"data\");\nconst INQUIRIES_FILE = path.join(DATA_DIR, \"inquiries.json\");\n\nasync function ensureDataDir() {\n  await fs.mkdir(DATA_DIR, { recursive: true });\n}\n\nasync function readInquiries(): Promise<Inquiry[]> {\n  try {\n    await ensureDataDir();\n    const data = await fs.readFile(INQUIRIES_FILE, \"utf-8\");\n    return JSON.parse(data);\n  } catch {\n    return [];\n  }\n}\n\nexport async function getInquiries(): Promise<Inquiry[]> {\n  const inquiries = await readInquiries();\n  return inquiries.sort(\n    (a, b) =>\n      new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n  );\n}\n\nexport async function getInquiryById(id: string): Promise<Inquiry | null> {\n  const inquiries = await readInquiries();\n  return inquiries.find((i) => i.id === id) ?? null;\n}\n\nexport async function addInquiry(\n  inquiry: Omit<Inquiry, \"id\" | \"status\" | \"createdAt\">\n): Promise<Inquiry> {\n  const { v4: uuid } = await import(\"uuid\");\n  const inquiries = await readInquiries();\n  const newInquiry: Inquiry = {\n    ...inquiry,\n    id: uuid(),\n    status: \"new\",\n    createdAt: new Date().toISOString(),\n  };\n  inquiries.push(newInquiry);\n  await ensureDataDir();\n  await fs.writeFile(INQUIRIES_FILE, JSON.stringify(inquiries, null, 2));\n  return newInquiry;\n}\n\nexport async function markInquiryReplied(id: string): Promise<boolean> {\n  const inquiries = await readInquiries();\n  const idx = inquiries.findIndex((i) => i.id === id);\n  if (idx === -1) return false;\n  inquiries[idx].status = \"replied\";\n  inquiries[idx].repliedAt = new Date().toISOString();\n  await ensureDataDir();\n  await fs.writeFile(INQUIRIES_FILE, JSON.stringify(inquiries, null, 2));\n  return true;\n}\n\nexport async function addReplyToInquiry(\n  id: string,\n  message: string\n): Promise<boolean> {\n  const inquiries = await readInquiries();\n  const idx = inquiries.findIndex((i) => i.id === id);\n  if (idx === -1) return false;\n  const reply: InquiryReply = {\n    message: message.trim(),\n    sentAt: new Date().toISOString(),\n  };\n  const inquiry = inquiries[idx];\n  inquiry.replies = inquiry.replies ?? [];\n  inquiry.replies.push(reply);\n  inquiry.status = \"replied\";\n  inquiry.repliedAt = reply.sentAt;\n  await ensureDataDir();\n  await fs.writeFile(INQUIRIES_FILE, JSON.stringify(inquiries, null, 2));\n  return true;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;;;AAmBA,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AAC1C,MAAM,iBAAiB,4GAAI,CAAC,IAAI,CAAC,UAAU;AAE3C,eAAe;IACb,MAAM,yGAAE,CAAC,KAAK,CAAC,UAAU;QAAE,WAAW;IAAK;AAC7C;AAEA,eAAe;IACb,IAAI;QACF,MAAM;QACN,MAAM,OAAO,MAAM,yGAAE,CAAC,QAAQ,CAAC,gBAAgB;QAC/C,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEO,eAAe;IACpB,MAAM,YAAY,MAAM;IACxB,OAAO,UAAU,IAAI,CACnB,CAAC,GAAG,IACF,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;AAErE;AAEO,eAAe,eAAe,EAAU;IAC7C,MAAM,YAAY,MAAM;IACxB,OAAO,UAAU,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,OAAO;AAC/C;AAEO,eAAe,WACpB,OAAqD;IAErD,MAAM,EAAE,IAAI,IAAI,EAAE,GAAG;IACrB,MAAM,YAAY,MAAM;IACxB,MAAM,aAAsB;QAC1B,GAAG,OAAO;QACV,IAAI;QACJ,QAAQ;QACR,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,UAAU,IAAI,CAAC;IACf,MAAM;IACN,MAAM,yGAAE,CAAC,SAAS,CAAC,gBAAgB,KAAK,SAAS,CAAC,WAAW,MAAM;IACnE,OAAO;AACT;AAEO,eAAe,mBAAmB,EAAU;IACjD,MAAM,YAAY,MAAM;IACxB,MAAM,MAAM,UAAU,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAChD,IAAI,QAAQ,CAAC,GAAG,OAAO;IACvB,SAAS,CAAC,IAAI,CAAC,MAAM,GAAG;IACxB,SAAS,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,OAAO,WAAW;IACjD,MAAM;IACN,MAAM,yGAAE,CAAC,SAAS,CAAC,gBAAgB,KAAK,SAAS,CAAC,WAAW,MAAM;IACnE,OAAO;AACT;AAEO,eAAe,kBACpB,EAAU,EACV,OAAe;IAEf,MAAM,YAAY,MAAM;IACxB,MAAM,MAAM,UAAU,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;IAChD,IAAI,QAAQ,CAAC,GAAG,OAAO;IACvB,MAAM,QAAsB;QAC1B,SAAS,QAAQ,IAAI;QACrB,QAAQ,IAAI,OAAO,WAAW;IAChC;IACA,MAAM,UAAU,SAAS,CAAC,IAAI;IAC9B,QAAQ,OAAO,GAAG,QAAQ,OAAO,IAAI,EAAE;IACvC,QAAQ,OAAO,CAAC,IAAI,CAAC;IACrB,QAAQ,MAAM,GAAG;IACjB,QAAQ,SAAS,GAAG,MAAM,MAAM;IAChC,MAAM;IACN,MAAM,yGAAE,CAAC,SAAS,CAAC,gBAAgB,KAAK,SAAS,CAAC,WAAW,MAAM;IACnE,OAAO;AACT"}},
    {"offset": {"line": 143, "column": 0}, "map": {"version":3,"sources":["file:///C:/Source/Repos/devsrus/src/app/api/admin/inquiries/reply/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { getInquiryById, addReplyToInquiry } from \"@/lib/inquiries\";\n\nasync function sendReplyEmail(\n  to: string,\n  toName: string,\n  originalSubject: string,\n  replyMessage: string\n) {\n  const nodemailer = await import(\"nodemailer\");\n\n  const transporter = nodemailer.default.createTransport({\n    host: process.env.SMTP_HOST,\n    port: Number(process.env.SMTP_PORT) || 587,\n    secure: process.env.SMTP_SECURE === \"true\",\n    auth: {\n      user: process.env.SMTP_USER,\n      pass: process.env.SMTP_PASS,\n    },\n  });\n\n  await transporter.sendMail({\n    from: process.env.SMTP_FROM || process.env.SMTP_USER,\n    to,\n    replyTo: process.env.SMTP_FROM || process.env.SMTP_USER,\n    subject: `Re: ${originalSubject}`,\n    text: replyMessage,\n    html: `<pre style=\"white-space: pre-wrap; font-family: sans-serif;\">${replyMessage.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")}</pre>`,\n  });\n}\n\nexport async function POST(req: NextRequest) {\n  try {\n    const body = await req.json();\n    const { id, message } = body;\n\n    if (!id || !message || typeof message !== \"string\") {\n      return NextResponse.json(\n        { error: \"Inquiry id and reply message are required\" },\n        { status: 400 }\n      );\n    }\n\n    const inquiry = await getInquiryById(String(id));\n    if (!inquiry) {\n      return NextResponse.json({ error: \"Inquiry not found\" }, { status: 404 });\n    }\n\n    const replyText = String(message).trim();\n    if (!replyText) {\n      return NextResponse.json(\n        { error: \"Reply message cannot be empty\" },\n        { status: 400 }\n      );\n    }\n\n    if (\n      !process.env.SMTP_HOST ||\n      !process.env.SMTP_USER ||\n      !process.env.SMTP_PASS\n    ) {\n      return NextResponse.json(\n        { error: \"Email is not configured. Set SMTP_* in .env.local\" },\n        { status: 500 }\n      );\n    }\n\n    await sendReplyEmail(\n      inquiry.email,\n      inquiry.name,\n      inquiry.subject,\n      replyText\n    );\n\n    await addReplyToInquiry(inquiry.id, replyText);\n\n    return NextResponse.json({ success: true });\n  } catch (err) {\n    console.error(\"Reply error:\", err);\n    return NextResponse.json(\n      { error: \"Failed to send reply\" },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,eAAe,eACb,EAAU,EACV,MAAc,EACd,eAAuB,EACvB,YAAoB;IAEpB,MAAM,aAAa;IAEnB,MAAM,cAAc,WAAW,OAAO,CAAC,eAAe,CAAC;QACrD,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,KAAK;QACvC,QAAQ,QAAQ,GAAG,CAAC,WAAW,KAAK;QACpC,MAAM;YACJ,MAAM,QAAQ,GAAG,CAAC,SAAS;YAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC7B;IACF;IAEA,MAAM,YAAY,QAAQ,CAAC;QACzB,MAAM,QAAQ,GAAG,CAAC,SAAS,IAAI,QAAQ,GAAG,CAAC,SAAS;QACpD;QACA,SAAS,QAAQ,GAAG,CAAC,SAAS,IAAI,QAAQ,GAAG,CAAC,SAAS;QACvD,SAAS,CAAC,IAAI,EAAE,iBAAiB;QACjC,MAAM;QACN,MAAM,CAAC,6DAA6D,EAAE,aAAa,OAAO,CAAC,MAAM,QAAQ,OAAO,CAAC,MAAM,QAAQ,MAAM,CAAC;IACxI;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,GAAG;QAExB,IAAI,CAAC,MAAM,CAAC,WAAW,OAAO,YAAY,UAAU;YAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA4C,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,MAAM,IAAA,2IAAc,EAAC,OAAO;QAC5C,IAAI,CAAC,SAAS;YACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,MAAM,YAAY,OAAO,SAAS,IAAI;QACtC,IAAI,CAAC,WAAW;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IACE,CAAC,QAAQ,GAAG,CAAC,SAAS,IACtB,CAAC,QAAQ,GAAG,CAAC,SAAS,IACtB,CAAC,QAAQ,GAAG,CAAC,SAAS,EACtB;YACA,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAoD,GAC7D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,eACJ,QAAQ,KAAK,EACb,QAAQ,IAAI,EACZ,QAAQ,OAAO,EACf;QAGF,MAAM,IAAA,8IAAiB,EAAC,QAAQ,EAAE,EAAE;QAEpC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC3C,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gBAAgB;QAC9B,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAuB,GAChC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}